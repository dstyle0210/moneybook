<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <script crossorigin src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script defer src="/__/firebase/9.6.1/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/9.6.1/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/9.6.1/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script defer src="./js/uikit.js"></script>
    <script defer src="./js/page.js"></script>
    
    

    <style media="screen">
      
    </style>
  </head>
  <body>


    <a href="#" onclick="login();return false;">로그인</a>
    <button id="write">등록하기</button>
    <button id="upload">업로드</button>
    


    <textarea id="sms"></textarea>

        


    <div>로딩중</div>
    <div id="data"></div>
    <div id="load"></div>
    <div id="reactRoot"></div>
    <div id="reactRoot2"></div>

    <script>
      



      



      // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.firestore().doc('/foo/bar').get().then(() => { });
        // firebase.functions().httpsCallable('yourFunction')().then(() => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        // firebase.analytics(); // call to activate
        // firebase.analytics().logEvent('tutorial_completed');
        // firebase.performance(); // call to activate
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥
        var gtoken,guser;
        function login(){
          const $data = $("#data");
          var provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().signInWithPopup(provider).then(function(result) {
            
            firebase.auth().onAuthStateChanged(user => { 
              console.log(user);
            });

            var user2 = result.user;
            console.log(user2);
          
            firebase.database().ref('/payment').on('value', snapshot => {
              $data.text(JSON.stringify(snapshot.val()));
            });

            }).catch(function(error) {
              // Handle Errors here.
              var errorCode = error.code;
              var errorMessage = error.message;
              // The email of the user's account used.
              var email = error.email;
              // The firebase.auth.AuthCredential type that was used.
              var credential = error.credential;
              // ...
            });
        };
      $(function(){
        const $load = $("#load");
        const $data = $("#data");
        try {
          firebase.auth().onAuthStateChanged(user => { 
            console.log(user);
          });

          // 구글 인증 기능 추가
          /*
          var provider = new firebase.auth.GoogleAuthProvider();
          firebase.auth().signInWithPopup(provider);
          // 인증하기
          firebase.auth().signInWithPopup(provider).then(function(result) {
            // This gives you a Google Access Token. You can use it to access the Google API.
            var token = gtoken = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;
            guser = firebase.auth().currentUser;
            
            console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
          }).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // ...
          });
          */



          let app = firebase.app();
          let features = [
            'auth', 
            'database', 
            'firestore',
            'functions',
            'messaging', 
            'storage', 
            'analytics', 
            'remoteConfig',
            'performance',
          ].filter(feature => typeof app[feature] === 'function');
          $load.text(`Firebase SDK loaded with ${features.join(', ')}`);

          firebase.database().ref('/payment').on('value', snapshot => {
            $data.text(JSON.stringify(snapshot.val()));
          });
           

        } catch (e) {
          console.error(e);
          $load.text('Error loading the Firebase SDK, check the console.');
        };





        $("#sms").hide();
        $("#write").on("click",() => {
          navigator.clipboard.readText().then((text) => {
            if( (/국민카드/).test(text) ){
              firebase.database().ref('/payment/test').set(text);
            }else{
              $("#sms").show();
            }
            // console.log('Pasted content: ', ); 
          });
          // alert("test");
        });



      });
    </script>
  </body>
</html>
